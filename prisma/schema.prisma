generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Verdict from one of the curators on a prospect
enum CurationStatus {
  RECOMMENDATION
  CORPUS
  DECLINE
}

// A prospect that is deemed good enough for saving in the corpus
// and (optionally) making it to New Tab.
model CuratedItem {
  // fields
  id             Int            @id @default(autoincrement())
  externalId     String         @default(uuid()) @db.VarChar(255)
  curatedImageId Int
  url            String         @db.VarChar(500)
  title          String         @db.VarChar(255)
  excerpt        String         @db.Text
  status         CurationStatus @default(CORPUS)
  language       String         @default("en") @db.VarChar(2)
  createdAt      DateTime       @default(now()) @db.DateTime(0)
  createdBy      String
  updatedAt      DateTime       @updatedAt
  updatedBy      String

  // associated models
  image         CuratedItemImage      @relation(fields: [curatedImageId], references: [id])
  scheduledItem NewTabScheduledItem[]

  // indexes
  @@unique([externalId])
  @@unique([url])
}

model NewTab {
  // fields
  id             Int      @id @default(autoincrement())
  externalId     String   @default(uuid()) @db.VarChar(255)
  // Similar to locale, but not quite. Examples: en-US, en-GB, en-INTL, de-DE
  code           String   @default("en_US") @db.VarChar(10)
  timezoneOffset String   @db.VarChar(30)
  createdAt      DateTime @default(now()) @db.DateTime(0)
  updatedAt      DateTime @updatedAt

  // associated models
  scheduledItems NewTabScheduledItem[]

  // indexes
  @@unique([externalId])
  @@unique([code])
}

// A curated item that's been scheduled to go on to one or more New Tabs
model NewTabScheduledItem {
  // fields
  id            Int      @id @default(autoincrement())
  externalId    String   @default(uuid()) @db.VarChar(255)
  curatedItemId Int
  newTabId      Int
  createdAt     DateTime @default(now()) @db.DateTime(0)
  createdBy     String
  updatedAt     DateTime @updatedAt
  updatedBy     String
  scheduledDate DateTime
  approvedBy    String

  // associated entities
  curatedItem CuratedItem @relation(fields: [curatedItemId], references: [id])
  newTab      NewTab      @relation(fields: [newTabId], references: [id])

  // indexes
  @@unique([externalId])
}

// A thumbnail image for a curated item.
// (Almost entirely pinched from Collection API, minus size type
// and entity type which don't seem to be needed here.)
model CuratedItemImage {
  // fields
  id            Int      @id @default(autoincrement())
  width         Int
  height        Int
  mimeType      String   @db.VarChar(255)
  fileSizeBytes Int
  fileName      String   @db.VarChar(255)
  path          String   @db.VarChar(255)
  createdAt     DateTime @default(now()) @db.DateTime(0)
  updatedAt     DateTime @updatedAt

  // associated models
  curatedItem CuratedItem[]

  // indexes
  // S3 path to image must be unique
  @@unique([path])
}
