generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Verdict from one of the curators on a prospect
enum CuratedStatus {
  RECOMMENDATION
  CORPUS
}

// A prospect that is deemed good enough for saving in the corpus
// and (optionally) making it to New Tab.
model CuratedItem {
  // fields
  id           Int           @id @default(autoincrement())
  externalId   String        @default(uuid()) @db.VarChar(255)
  url          String        @db.VarChar(500)
  title        String        @db.VarChar(255)
  excerpt      String        @db.Text
  status       CuratedStatus @default(CORPUS)
  language     String        @db.VarChar(2)
  imageUrl     String        @db.VarChar(500)
  topic        String        @db.VarChar(255)
  isCollection Boolean       @default(false)
  isShortLived Boolean       @default(false)
  isSyndicated Boolean       @default(false)
  createdAt    DateTime      @default(now()) @db.DateTime(0)
  createdBy    String        @db.VarChar(255)
  updatedAt    DateTime      @updatedAt
  updatedBy    String?       @db.VarChar(255)

  // associated models
  scheduledItems NewTabFeedSchedule[]

  // indexes
  @@unique([externalId])
  @@unique([url])
}

model RejectedCuratedCorpusItem {
  // fields
  id         Int      @id @default(autoincrement())
  externalId String   @default(uuid()) @db.VarChar(255)
  url        String   @db.VarChar(500)
  title      String   @db.VarChar(255)
  topic      String   @db.VarChar(255)
  language   String   @db.VarChar(2)
  publisher  String   @db.VarChar(255)
  reason     String   @db.VarChar(255)
  createdAt  DateTime @default(now()) @db.DateTime(0)
  createdBy  String   @db.VarChar(255)

  // indexes
  @@unique([externalId])
  @@unique([url])
}

model NewTabFeed {
  // fields
  id         Int      @id @default(autoincrement())
  externalId String   @default(uuid()) @db.VarChar(255)
  name       String   @db.VarChar(255)
  // Similar to locale, but not quite. Examples: en-US, en-GB, en-INTL, de-DE
  shortName  String   @default("en_US") @db.VarChar(10)
  utcOffset  String   @db.VarChar(6)
  createdAt  DateTime @default(now()) @db.DateTime(0)
  updatedAt  DateTime @updatedAt

  // associated models
  scheduledItems NewTabFeedSchedule[]

  // indexes
  @@unique([externalId])
  @@unique([shortName])
}

// A curated item that's been scheduled to go on to one or more New Tabs
model NewTabFeedSchedule {
  // fields
  id            Int      @id @default(autoincrement())
  externalId    String   @default(uuid()) @db.VarChar(255)
  curatedItemId Int
  newTabFeedId  Int
  createdAt     DateTime @default(now()) @db.DateTime(0)
  createdBy     String   @db.VarChar(255)
  updatedAt     DateTime @updatedAt
  updatedBy     String?  @db.VarChar(255)
  scheduledDate DateTime @db.Date

  // associated entities
  curatedItem CuratedItem @relation(fields: [curatedItemId], references: [id])
  newTabFeed  NewTabFeed  @relation(fields: [newTabFeedId], references: [id])

  // indexes
  @@unique([externalId])
}
